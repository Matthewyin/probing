# ç½‘ç»œè¯Šæ–­å·¥å…·ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ

> ğŸš€ **ä¼ä¸šçº§ç½‘ç»œè¯Šæ–­å’Œç›‘æ§å¹³å°** - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œæœ€ä½³å®è·µ

## ğŸ“– ç›®å½•

1. [å·¥å…·æ¦‚è¿°](#å·¥å…·æ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [åŸºç¡€åŠŸèƒ½ä½¿ç”¨](#åŸºç¡€åŠŸèƒ½ä½¿ç”¨)
4. [ä¼ä¸šçº§åŠŸèƒ½](#ä¼ä¸šçº§åŠŸèƒ½)
5. [ç›‘æ§å’Œå‘Šè­¦](#ç›‘æ§å’Œå‘Šè­¦)
6. [è‡ªåŠ¨æ¢å¤](#è‡ªåŠ¨æ¢å¤)
7. [æµ‹è¯•å’ŒéªŒè¯](#æµ‹è¯•å’ŒéªŒè¯)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
9. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
10. [ç”Ÿäº§éƒ¨ç½²](#ç”Ÿäº§éƒ¨ç½²)

## 1. å·¥å…·æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ç½‘ç»œè¯Šæ–­å·¥å…·ï¼Ÿ

ç½‘ç»œè¯Šæ–­å·¥å…·æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§ç½‘ç»œè¯Šæ–­å’Œç›‘æ§å¹³å°**ï¼Œé›†æˆäº†æ™ºèƒ½ç›‘æ§ã€è‡ªåŠ¨æ¢å¤å’Œé«˜å¯ç”¨æ¶æ„ã€‚å®ƒä¸ä»…èƒ½å¤Ÿå¯¹æŒ‡å®šçš„åŸŸåã€IPåœ°å€æˆ–URLè¿›è¡Œå…¨é¢çš„ç½‘ç»œè¯Šæ–­ï¼Œè¿˜æä¾›äº†å®Œæ•´çš„ç³»ç»Ÿç›‘æ§ã€å‘Šè­¦å’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œç¡®ä¿é•¿æœŸç¨³å®šè¿è¡Œã€‚

### ğŸŒŸ æ ¸å¿ƒä¼˜åŠ¿

- **ğŸ›¡ï¸ ä¼ä¸šçº§ç¨³å®šæ€§** - é›¶èµ„æºæ³„æ¼ï¼Œå¯ç¨³å®šè¿è¡Œæ•°æœˆ
- **ğŸ“Š æ™ºèƒ½ç›‘æ§** - å®æ—¶ç³»ç»Ÿå¥åº·ç›‘æ§å’Œå‘Šè­¦
- **ğŸ”„ è‡ªåŠ¨æ¢å¤** - æ•…éšœè‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤æœºåˆ¶
- **âš¡ é«˜æ€§èƒ½** - ä¼˜åŒ–çš„æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤§è§„æ¨¡å¹¶å‘
- **ğŸ§ª å…¨é¢æµ‹è¯•** - 30+æµ‹è¯•ç”¨ä¾‹ç¡®ä¿åŠŸèƒ½å¯é æ€§

### ä¸»è¦åŠŸèƒ½

#### ğŸ” **ç½‘ç»œè¯Šæ–­åŠŸèƒ½**

| åŠŸèƒ½æ¨¡å— | æè¿° | è¾“å‡ºä¿¡æ¯ |
|----------|------|----------|
| **DNSè§£æåˆ†æ** | åŸŸåè§£ææ€§èƒ½å’Œè¯¦æƒ… | è§£ææ—¶é—´ã€å¤šIPåœ°å€ã€DNSæœåŠ¡å™¨ä¿¡æ¯ |
| **TCPè¿æ¥æµ‹è¯•** | æµ‹è¯•ç›®æ ‡ä¸»æœºçš„TCPè¿æ¥æ€§èƒ½ | è¿æ¥æ—¶é—´ã€æœ¬åœ°/è¿œç¨‹åœ°å€ã€Socketä¿¡æ¯ |
| **TLS/SSLåˆ†æ** | æ”¶é›†TLSæ¡æ‰‹å’Œè¯ä¹¦ä¿¡æ¯ | åè®®ç‰ˆæœ¬ã€åŠ å¯†å¥—ä»¶ã€è¯ä¹¦è¯¦æƒ…ã€æœ‰æ•ˆæœŸ |
| **HTTPå“åº”æ£€æŸ¥** | åˆ†æHTTP/HTTPSè¯·æ±‚å’Œå“åº” | çŠ¶æ€ç ã€å“åº”å¤´ã€å“åº”æ—¶é—´ã€é‡å®šå‘é“¾ |
| **ICMPæ¢æµ‹** | ä½¿ç”¨pingå‘½ä»¤æµ‹è¯•ç½‘ç»œè¿é€šæ€§ | RTTç»Ÿè®¡ã€ä¸¢åŒ…ç‡ã€æ•°æ®åŒ…ç»Ÿè®¡ |
| **ç½‘ç»œè·¯å¾„è¿½è¸ª** | è¿½è¸ªåˆ°ç›®æ ‡çš„ç½‘ç»œè·¯å¾„ | è·³ç‚¹ä¿¡æ¯ã€å»¶è¿Ÿç»Ÿè®¡ã€ä¸¢åŒ…ç‡ã€ASNä¿¡æ¯ |
| **æ‰¹é‡è¯Šæ–­** | åŒæ—¶è¯Šæ–­å¤šä¸ªç›®æ ‡ | æ±‡æ€»ç»Ÿè®¡ã€æ€§èƒ½åˆ†æã€å®‰å…¨è¯„ä¼° |

#### ğŸ†• **å¢å¼ºåŠŸèƒ½**

| åŠŸèƒ½æ¨¡å— | æè¿° | è¾“å‡ºä¿¡æ¯ |
|----------|------|----------|
| **HTTPå¤´å¢å¼ºè§£æ** | æå–æºç«™ä¿¡æ¯å’ŒCDNæ£€æµ‹ | æºç«™IPã€CDNæä¾›å•†ã€å®‰å…¨å¤´åˆ†æ |
| **ICMPå¤šIPæ‹¨æµ‹** | å¹¶è¡Œæµ‹è¯•æ‰€æœ‰DNSè§£æçš„IP | å¤šIPæ€§èƒ½å¯¹æ¯”ã€æœ€ä½³IPè¯†åˆ« |
| **MTRå¤šIPæ‹¨æµ‹** | å¹¶è¡Œè·¯å¾„è¿½è¸ªå’Œè·¯å¾„å¯¹æ¯” | å…±åŒè·³ç‚¹ã€è·¯å¾„å·®å¼‚ã€æ€§èƒ½åˆ†æ |

#### ğŸ›¡ï¸ **ä¼ä¸šçº§åŠŸèƒ½**

| åŠŸèƒ½æ¨¡å— | æè¿° | è¾“å‡ºä¿¡æ¯ |
|----------|------|----------|
| **å•ä¾‹æ—¥å¿—ç®¡ç†** | é¿å…æ—¥å¿—å¤„ç†å™¨æ³„æ¼ | ç»Ÿä¸€æ—¥å¿—ç®¡ç†ã€èµ„æºå¤ç”¨ |
| **æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ** | å®æ—¶ç³»ç»Ÿå¥åº·ç›‘æ§ | å‘Šè­¦é˜ˆå€¼ã€é€šçŸ¥æœºåˆ¶ã€æ•°æ®æŒä¹…åŒ– |
| **è‡ªåŠ¨æ¢å¤æœºåˆ¶** | æ•…éšœè‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤ | å¤šç§æ¢å¤ç­–ç•¥ã€å†·å´æœºåˆ¶ã€çŠ¶æ€ç›‘æ§ |
| **å®šæ—¶ä»»åŠ¡è°ƒåº¦** | è‡ªåŠ¨åŒ–å®šæœŸç›‘æ§ | çµæ´»è°ƒåº¦ã€é…ç½®çƒ­é‡è½½ã€å†å²è®°å½• |

## 2. å¿«é€Ÿå¼€å§‹

### 2.1 å®‰è£…

```bash
# 1. å®‰è£…uvåŒ…ç®¡ç†å™¨
curl -LsSf https://astral.sh/uv/install.sh | sh

# 2. å…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–
git clone https://github.com/Matthewyin/probing.git
cd probing
uv sync

# 3. è¿è¡Œç¬¬ä¸€ä¸ªè¯Šæ–­
uv run python main.py google.com
```

### 2.2 åŸºæœ¬ä½¿ç”¨

```bash
# è¯Šæ–­HTTPSç½‘ç«™
uv run python main.py github.com

# è¯Šæ–­HTTPç½‘ç«™
uv run python main.py httpbin.org --port 80

# æ‰¹é‡è¯Šæ–­å¤šä¸ªç›®æ ‡
uv run python batch_main.py --create-sample  # åˆ›å»ºé…ç½®æ–‡ä»¶
uv run python batch_main.py -c network-diagnosis/input/targets.yaml

# å®šæ—¶ä»»åŠ¡åŠŸèƒ½
uv run python scheduler_main.py --status -c input/targets_sample.yaml
uv run python scheduler_main.py -c input/targets_sample.yaml

# ç³»ç»Ÿç›‘æ§å’Œæµ‹è¯•
uv run python comprehensive_test.py           # è¿è¡Œå®Œæ•´ç³»ç»Ÿæµ‹è¯•
uv run python test_phase3_integration.py     # è¿è¡Œé›†æˆæµ‹è¯•
```

### 2.3 éªŒè¯å®‰è£…

```bash
# å¿«é€ŸéªŒè¯ç³»ç»ŸçŠ¶æ€
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.enhanced_monitor import get_enhanced_monitor
from network_diagnosis.auto_recovery import get_auto_recovery_system
monitor = get_enhanced_monitor()
recovery = get_auto_recovery_system()
print('âœ… ç›‘æ§ç³»ç»ŸçŠ¶æ€:', monitor.get_status()['monitoring_enabled'])
print('âœ… æ¢å¤ç³»ç»ŸçŠ¶æ€:', recovery.get_status()['enabled'])
print('ğŸ‰ ç³»ç»Ÿå®‰è£…æˆåŠŸï¼')
"
```

## 3. åŸºç¡€åŠŸèƒ½ä½¿ç”¨

### 3.1 å•ç›®æ ‡è¯Šæ–­

```bash
# åŸºæœ¬è¯Šæ–­
uv run python main.py example.com

# æŒ‡å®šç«¯å£
uv run python main.py example.com --port 8080

# è¯¦ç»†è¾“å‡º
uv run python main.py example.com --verbose

# ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
uv run python main.py example.com --output results.json
```

### 3.2 æ‰¹é‡è¯Šæ–­

#### åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºç¤ºä¾‹é…ç½®æ–‡ä»¶
uv run python batch_main.py --create-sample
```

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
targets:
  - domain: "google.com"
    port: 443
    description: "Googleæœç´¢å¼•æ“"
  
  - domain: "httpbin.org"
    port: 80
    description: "HTTPæµ‹è¯•æœåŠ¡"

global_settings:
  max_concurrent: 3      # å¹¶å‘æ•° (1-10)
  timeout_seconds: 60    # è¶…æ—¶æ—¶é—´
  save_summary_report: true

# ğŸ†• è°ƒåº¦å™¨é…ç½®
scheduler:
  enabled: true
  trigger_type: "cron"   # æˆ– "interval"
  cron: "0 */2 * * *"    # æ¯2å°æ—¶æ‰§è¡Œä¸€æ¬¡
  # interval_minutes: 30 # æˆ–æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
```

#### æ‰§è¡Œæ‰¹é‡è¯Šæ–­

```bash
# æ‰§è¡Œæ‰¹é‡è¯Šæ–­
uv run python batch_main.py -c network-diagnosis/input/targets.yaml

# å¯åŠ¨å®šæ—¶ä»»åŠ¡
uv run python scheduler_main.py -c network-diagnosis/input/targets.yaml

# æŸ¥çœ‹è°ƒåº¦å™¨çŠ¶æ€
uv run python scheduler_main.py --status -c network-diagnosis/input/targets.yaml
```

### 3.3 è¾“å‡ºç»“æœè§£è¯»

#### JSONè¯Šæ–­æŠ¥å‘Š

```json
{
  "domain": "example.com",
  "target_ip": "93.184.216.34",
  "success": true,
  "total_time_ms": 567.89,
  "tcp_connection": {
    "connect_time_ms": 45.23,
    "is_connected": true
  },
  "tls_info": {
    "protocol_version": "TLSv1.3",
    "cipher_suite": "TLS_AES_256_GCM_SHA384"
  },
  "http_response": {
    "status_code": 200,
    "response_time_ms": 234.56,
    "origin_info": {
      "real_ip": "192.168.1.100",
      "cdn_provider": "cloudflare"
    }
  },
  "multi_ip_icmp": {
    "tested_ips": ["1.2.3.4", "5.6.7.8"],
    "summary": {
      "success_rate": 1.0,
      "best_performing_ip": "1.2.3.4"
    }
  }
}
```

## 4. ä¼ä¸šçº§åŠŸèƒ½

### 4.1 å•ä¾‹æ—¥å¿—ç®¡ç†

#### ç‰¹æ€§è¯´æ˜

- **é›¶èµ„æºæ³„æ¼**: å®Œå…¨è§£å†³"Too many open files"é—®é¢˜
- **çº¿ç¨‹å®‰å…¨**: æ”¯æŒå¹¶å‘è®¿é—®çš„å•ä¾‹æ¨¡å¼
- **é…ç½®å¤ç”¨**: é¿å…é‡å¤åˆ›å»ºæ—¥å¿—å¤„ç†å™¨
- **è‡ªåŠ¨æ¸…ç†**: æ™ºèƒ½èµ„æºç®¡ç†å’Œé‡Šæ”¾

#### ä½¿ç”¨æ–¹å¼

```python
from network_diagnosis.singleton_logger import get_singleton_logger_manager

# è·å–å•ä¾‹æ—¥å¿—ç®¡ç†å™¨
logger_manager = get_singleton_logger_manager()

# è·å–é…ç½®å¥½çš„æ—¥å¿—å™¨
logger = logger_manager.get_logger("my_module")

# ä½¿ç”¨æ—¥å¿—å™¨
logger.info("è¿™æ˜¯ä¸€æ¡æ—¥å¿—æ¶ˆæ¯")
```

### 4.2 æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ

#### ç‰¹æ€§è¯´æ˜

- **å®æ—¶ç›‘æ§**: ç³»ç»Ÿèµ„æºã€è¿›ç¨‹çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡
- **æ™ºèƒ½å‘Šè­¦**: å¯é…ç½®é˜ˆå€¼ã€å¤šçº§å‘Šè­¦ã€è‡ªåŠ¨é€šçŸ¥
- **æ•°æ®æŒä¹…åŒ–**: å®Œæ•´çš„ç›‘æ§æ•°æ®å’Œå‘Šè­¦å†å²
- **å¤šç§é€šçŸ¥**: æ—¥å¿—ã€æ–‡ä»¶ã€é‚®ä»¶ç­‰é€šçŸ¥æ–¹å¼

#### ä½¿ç”¨æ–¹å¼

```python
from network_diagnosis.enhanced_monitor import get_enhanced_monitor

# è·å–ç›‘æ§ç³»ç»Ÿ
monitor = get_enhanced_monitor()

# è·å–ç³»ç»ŸçŠ¶æ€
status = monitor.get_status()
print(f"ç›‘æ§çŠ¶æ€: {status['monitoring_enabled']}")

# æ”¶é›†æŒ‡æ ‡
metrics = monitor.collect_metrics()
print(f"å½“å‰æŒ‡æ ‡: {metrics}")

# æ£€æŸ¥å‘Šè­¦
alerts = monitor.check_thresholds(metrics)
for alert in alerts:
    print(f"å‘Šè­¦: {alert.message}")
```

#### é…ç½®å‘Šè­¦é˜ˆå€¼

```python
from network_diagnosis.enhanced_monitor import AlertThreshold

# é…ç½®è‡ªå®šä¹‰é˜ˆå€¼
thresholds = [
    AlertThreshold(
        metric_name="open_files",
        warning_threshold=100,
        critical_threshold=200,
        comparison="greater"
    ),
    AlertThreshold(
        metric_name="memory_usage_mb",
        warning_threshold=500,
        critical_threshold=1000,
        comparison="greater"
    )
]

# åº”ç”¨é…ç½®
monitor.configure_thresholds(thresholds)
```

### 4.3 è‡ªåŠ¨æ¢å¤æœºåˆ¶

#### ç‰¹æ€§è¯´æ˜

- **æ•…éšœæ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿå¼‚å¸¸å’Œèµ„æºé—®é¢˜
- **æ™ºèƒ½æ¢å¤**: å¤šç§æ¢å¤ç­–ç•¥ï¼ˆèµ„æºæ¸…ç†ã€æœåŠ¡é‡å¯ç­‰ï¼‰
- **å†·å´æœºåˆ¶**: é˜²æ­¢é¢‘ç¹æ¢å¤æ“ä½œ
- **çŠ¶æ€ç›‘æ§**: å®Œæ•´çš„æ¢å¤å†å²å’ŒçŠ¶æ€è·Ÿè¸ª

#### ä½¿ç”¨æ–¹å¼

```python
from network_diagnosis.auto_recovery import get_auto_recovery_system

# è·å–è‡ªåŠ¨æ¢å¤ç³»ç»Ÿ
recovery = get_auto_recovery_system()

# è·å–ç³»ç»ŸçŠ¶æ€
status = recovery.get_status()
print(f"æ¢å¤ç³»ç»ŸçŠ¶æ€: {status['enabled']}")

# æ‰‹åŠ¨è§¦å‘æ¢å¤æ£€æŸ¥
await recovery.check_and_recover()

# è·å–æ¢å¤å†å²
history = recovery.get_recovery_history()
for attempt in history:
    print(f"æ¢å¤å°è¯•: {attempt.action} - {attempt.success}")
```

#### é…ç½®æ¢å¤è§„åˆ™

```python
from network_diagnosis.auto_recovery import RecoveryRule, RecoveryAction

# é…ç½®æ¢å¤è§„åˆ™
rules = [
    RecoveryRule(
        name="high_file_handles",
        trigger_condition="open_files > 150",
        action=RecoveryAction.CLEANUP_RESOURCES,
        max_attempts=3,
        cooldown_seconds=300
    ),
    RecoveryRule(
        name="memory_leak",
        trigger_condition="memory_usage_mb > 800",
        action=RecoveryAction.RESTART_LOGGING,
        max_attempts=2,
        cooldown_seconds=600
    )
]

# åº”ç”¨é…ç½®
recovery.configure_rules(rules)
```

## 5. ç›‘æ§å’Œå‘Šè­¦

### 5.1 ç›‘æ§æ•°æ®

#### ç³»ç»ŸæŒ‡æ ‡

- **open_files**: å½“å‰æ‰“å¼€çš„æ–‡ä»¶æ•°é‡
- **file_handlers**: æ—¥å¿—æ–‡ä»¶å¤„ç†å™¨æ•°é‡
- **active_processes**: æ´»è·ƒè¿›ç¨‹æ•°é‡
- **memory_usage_mb**: å†…å­˜ä½¿ç”¨é‡ï¼ˆMBï¼‰
- **cpu_usage_percent**: CPUä½¿ç”¨ç‡

#### æ•°æ®å­˜å‚¨

ç›‘æ§æ•°æ®å­˜å‚¨åœ¨ `network-diagnosis/monitoring_data/` ç›®å½•ï¼š

- **metrics.jsonl**: ç³»ç»ŸæŒ‡æ ‡æ•°æ®ï¼ˆJSON Linesæ ¼å¼ï¼‰
- **alerts.jsonl**: å‘Šè­¦äº‹ä»¶è®°å½•ï¼ˆJSON Linesæ ¼å¼ï¼‰

#### æŸ¥çœ‹ç›‘æ§æ•°æ®

```bash
# æŸ¥çœ‹æœ€æ–°æŒ‡æ ‡
tail -f network-diagnosis/monitoring_data/metrics.jsonl

# æŸ¥çœ‹å‘Šè­¦å†å²
tail -f network-diagnosis/monitoring_data/alerts.jsonl

# åˆ†æç›‘æ§æ•°æ®
cat network-diagnosis/monitoring_data/metrics.jsonl | jq '.'
```

### 5.2 å‘Šè­¦é…ç½®

#### é»˜è®¤å‘Šè­¦é˜ˆå€¼

```python
DEFAULT_THRESHOLDS = [
    AlertThreshold("open_files", 100, 200, "greater"),
    AlertThreshold("file_handlers", 10, 20, "greater"),
    AlertThreshold("active_processes", 50, 100, "greater"),
    AlertThreshold("memory_usage_mb", 500, 1000, "greater"),
    AlertThreshold("cpu_usage_percent", 80, 95, "greater")
]
```

#### è‡ªå®šä¹‰å‘Šè­¦

```python
# åˆ›å»ºè‡ªå®šä¹‰å‘Šè­¦é˜ˆå€¼
custom_threshold = AlertThreshold(
    metric_name="custom_metric",
    warning_threshold=50.0,
    critical_threshold=80.0,
    comparison="greater",
    enabled=True
)

# æ·»åŠ åˆ°ç›‘æ§ç³»ç»Ÿ
monitor.add_threshold(custom_threshold)
```

## 6. è‡ªåŠ¨æ¢å¤

### 6.1 æ¢å¤ç­–ç•¥

#### å¯ç”¨çš„æ¢å¤åŠ¨ä½œ

- **CLEANUP_RESOURCES**: æ¸…ç†ç³»ç»Ÿèµ„æº
- **RESTART_LOGGING**: é‡å¯æ—¥å¿—ç³»ç»Ÿ
- **KILL_PROCESSES**: ç»ˆæ­¢å¼‚å¸¸è¿›ç¨‹
- **EMERGENCY_SHUTDOWN**: ç´§æ€¥å…³é—­ç³»ç»Ÿ

#### æ¢å¤è§„åˆ™é…ç½®

```python
# é«˜æ–‡ä»¶å¥æŸ„æ•°æ¢å¤è§„åˆ™
high_files_rule = RecoveryRule(
    name="high_file_handles",
    trigger_condition="open_files > 150",
    action=RecoveryAction.CLEANUP_RESOURCES,
    max_attempts=3,
    cooldown_seconds=300,
    enabled=True
)

# å†…å­˜æ³„æ¼æ¢å¤è§„åˆ™
memory_leak_rule = RecoveryRule(
    name="memory_leak",
    trigger_condition="memory_usage_mb > 800",
    action=RecoveryAction.RESTART_LOGGING,
    max_attempts=2,
    cooldown_seconds=600,
    enabled=True
)
```

### 6.2 æ¢å¤å†å²

#### æŸ¥çœ‹æ¢å¤å†å²

```python
# è·å–æ¢å¤å†å²
recovery_system = get_auto_recovery_system()
history = recovery_system.get_recovery_history()

for attempt in history:
    print(f"æ—¶é—´: {attempt.timestamp}")
    print(f"è§„åˆ™: {attempt.rule_name}")
    print(f"åŠ¨ä½œ: {attempt.action}")
    print(f"æˆåŠŸ: {attempt.success}")
    print(f"æ¶ˆæ¯: {attempt.message}")
    print("---")
```

#### æ¢å¤ç»Ÿè®¡

```python
# è·å–æ¢å¤ç»Ÿè®¡
stats = recovery_system.get_recovery_stats()
print(f"æ€»æ¢å¤å°è¯•: {stats['total_attempts']}")
print(f"æˆåŠŸæ¢å¤: {stats['successful_recoveries']}")
print(f"å¤±è´¥æ¢å¤: {stats['failed_recoveries']}")
print(f"æˆåŠŸç‡: {stats['success_rate']:.2%}")
```

## 7. æµ‹è¯•å’ŒéªŒè¯

### 7.1 è¿è¡Œæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œå®Œæ•´ç³»ç»Ÿæµ‹è¯•
uv run python comprehensive_test.py

# è¿è¡Œå•ä¾‹æ—¥å¿—ç®¡ç†å™¨æµ‹è¯•
uv run python test_singleton_logger.py

# è¿è¡Œå¢å¼ºç›‘æ§ç³»ç»Ÿæµ‹è¯•
uv run python test_enhanced_monitor.py

# è¿è¡Œè‡ªåŠ¨æ¢å¤æœºåˆ¶æµ‹è¯•
uv run python test_auto_recovery.py

# è¿è¡Œé›†æˆæµ‹è¯•
uv run python test_phase3_integration.py
```

### 7.2 æµ‹è¯•ç»“æœè§£è¯»

#### æˆåŠŸçš„æµ‹è¯•è¾“å‡º

```
âœ… å•ä¾‹æ—¥å¿—ç®¡ç†å™¨æµ‹è¯•: 6/6 é€šè¿‡
âœ… å¢å¼ºç›‘æ§ç³»ç»Ÿæµ‹è¯•: 8/8 é€šè¿‡
âœ… è‡ªåŠ¨æ¢å¤æœºåˆ¶æµ‹è¯•: 9/9 é€šè¿‡
âœ… é›†æˆæµ‹è¯•: 7/7 é€šè¿‡

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç³»ç»Ÿè¿è¡Œæ­£å¸¸ã€‚
```

#### æµ‹è¯•å¤±è´¥å¤„ç†

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š

1. **ä¾èµ–å®‰è£…**: ç¡®ä¿æ‰€æœ‰ä¾èµ–æ­£ç¡®å®‰è£…
2. **æƒé™é—®é¢˜**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ–‡ä»¶å’Œç½‘ç»œæƒé™
3. **èµ„æºé™åˆ¶**: æ£€æŸ¥ç³»ç»Ÿèµ„æºé™åˆ¶
4. **é…ç½®é—®é¢˜**: éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®

### 7.3 æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
uv run python -c "
import time
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.enhanced_monitor import get_enhanced_monitor

monitor = get_enhanced_monitor()
start_time = time.time()

# æ”¶é›†100æ¬¡æŒ‡æ ‡
for i in range(100):
    metrics = monitor.collect_metrics()

end_time = time.time()
avg_time = (end_time - start_time) / 100 * 1000

print(f'å¹³å‡æŒ‡æ ‡æ”¶é›†æ—¶é—´: {avg_time:.2f}ms')
print('âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡' if avg_time < 10 else 'âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥')
"
```

## 8. æ•…éšœæ’æŸ¥

### 8.1 å¸¸è§é—®é¢˜

#### "Too many open files" é”™è¯¯

**ç—‡çŠ¶**: ç³»ç»ŸæŠ¥å‘Šæ–‡ä»¶å¥æŸ„è€—å°½

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥å½“å‰æ–‡ä»¶å¥æŸ„ä½¿ç”¨æƒ…å†µ
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.resource_monitor import ResourceMonitor
monitor = ResourceMonitor()
status = monitor.get_comprehensive_status()
print(f'æ–‡ä»¶å¥æŸ„ä½¿ç”¨: {status[\"file_handles\"]}')
print(f'ç³»ç»ŸçŠ¶æ€: {status[\"overall_status\"]}')
"

# æ‰‹åŠ¨è§¦å‘èµ„æºæ¸…ç†
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.auto_recovery import get_auto_recovery_system
recovery = get_auto_recovery_system()
import asyncio
asyncio.run(recovery.check_and_recover())
"
```

#### ç›‘æ§ç³»ç»Ÿæ— å“åº”

**ç—‡çŠ¶**: ç›‘æ§æ•°æ®ä¸æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡å¯ç›‘æ§ç³»ç»Ÿ
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.enhanced_monitor import get_enhanced_monitor
monitor = get_enhanced_monitor()
monitor.restart()
print('âœ… ç›‘æ§ç³»ç»Ÿå·²é‡å¯')
"
```

#### è‡ªåŠ¨æ¢å¤ä¸å·¥ä½œ

**ç—‡çŠ¶**: ç³»ç»Ÿå¼‚å¸¸ä½†æœªè‡ªåŠ¨æ¢å¤

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ¢å¤ç³»ç»ŸçŠ¶æ€
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.auto_recovery import get_auto_recovery_system
recovery = get_auto_recovery_system()
status = recovery.get_status()
print(f'æ¢å¤ç³»ç»Ÿå¯ç”¨: {status[\"enabled\"]}')
print(f'æ´»è·ƒè§„åˆ™æ•°: {len(status[\"active_rules\"])}')
for rule in status['active_rules']:
    print(f'  - {rule}')
"
```

### 8.2 æ—¥å¿—åˆ†æ

#### æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f network-diagnosis/log/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f network-diagnosis/log/error.log

# æŸ¥çœ‹ç›‘æ§æ—¥å¿—
tail -f network-diagnosis/log/monitor.log
```

#### æ—¥å¿—çº§åˆ«è°ƒæ•´

```python
# è®¾ç½®è¯¦ç»†æ—¥å¿—çº§åˆ«
import logging
logging.getLogger().setLevel(logging.DEBUG)

# æˆ–åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®
export LOG_LEVEL=DEBUG
```

### 8.3 ç³»ç»Ÿå¥åº·æ£€æŸ¥

```bash
# å®Œæ•´çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')

# æ£€æŸ¥å•ä¾‹æ—¥å¿—ç®¡ç†å™¨
from network_diagnosis.singleton_logger import get_singleton_logger_manager
logger_manager = get_singleton_logger_manager()
print(f'âœ… æ—¥å¿—ç®¡ç†å™¨çŠ¶æ€: {logger_manager.get_status()[\"initialized\"]}')

# æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ
from network_diagnosis.enhanced_monitor import get_enhanced_monitor
monitor = get_enhanced_monitor()
print(f'âœ… ç›‘æ§ç³»ç»ŸçŠ¶æ€: {monitor.get_status()[\"monitoring_enabled\"]}')

# æ£€æŸ¥æ¢å¤ç³»ç»Ÿ
from network_diagnosis.auto_recovery import get_auto_recovery_system
recovery = get_auto_recovery_system()
print(f'âœ… æ¢å¤ç³»ç»ŸçŠ¶æ€: {recovery.get_status()[\"enabled\"]}')

# æ£€æŸ¥èµ„æºçŠ¶æ€
from network_diagnosis.resource_monitor import ResourceMonitor
resource_monitor = ResourceMonitor()
status = resource_monitor.get_comprehensive_status()
print(f'âœ… ç³»ç»Ÿæ•´ä½“çŠ¶æ€: {status[\"overall_status\"]}')

print('ğŸ‰ ç³»ç»Ÿå¥åº·æ£€æŸ¥å®Œæˆï¼')
"
```

## 9. æœ€ä½³å®è·µ

### 9.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

#### ç›‘æ§é˜ˆå€¼é…ç½®

```python
# ç”Ÿäº§ç¯å¢ƒæ¨èé˜ˆå€¼
PRODUCTION_THRESHOLDS = [
    AlertThreshold("open_files", 200, 400, "greater"),
    AlertThreshold("file_handlers", 20, 50, "greater"),
    AlertThreshold("active_processes", 100, 200, "greater"),
    AlertThreshold("memory_usage_mb", 1000, 2000, "greater"),
    AlertThreshold("cpu_usage_percent", 70, 90, "greater")
]
```

#### æ¢å¤ç­–ç•¥é…ç½®

```python
# ç”Ÿäº§ç¯å¢ƒæ¢å¤è§„åˆ™
PRODUCTION_RECOVERY_RULES = [
    RecoveryRule(
        name="critical_file_handles",
        trigger_condition="open_files > 350",
        action=RecoveryAction.CLEANUP_RESOURCES,
        max_attempts=5,
        cooldown_seconds=180
    ),
    RecoveryRule(
        name="memory_pressure",
        trigger_condition="memory_usage_mb > 1500",
        action=RecoveryAction.RESTART_LOGGING,
        max_attempts=3,
        cooldown_seconds=300
    )
]
```

### 9.2 æ€§èƒ½ä¼˜åŒ–

#### å¹¶å‘é…ç½®

```yaml
# æ‰¹é‡è¯Šæ–­æ€§èƒ½é…ç½®
global_settings:
  max_concurrent: 5          # æ ¹æ®ç³»ç»Ÿæ€§èƒ½è°ƒæ•´
  timeout_seconds: 30        # é€‚å½“çš„è¶…æ—¶æ—¶é—´
  save_summary_report: true
  
# è°ƒåº¦å™¨æ€§èƒ½é…ç½®
scheduler:
  enabled: true
  trigger_type: "cron"
  cron: "0 */1 * * *"        # æ ¹æ®éœ€æ±‚è°ƒæ•´é¢‘ç‡
```

#### èµ„æºé™åˆ¶

```bash
# è®¾ç½®ç³»ç»Ÿèµ„æºé™åˆ¶
ulimit -n 4096              # å¢åŠ æ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -u 2048              # å¢åŠ è¿›ç¨‹æ•°é™åˆ¶
```

### 9.3 ç›‘æ§ç­–ç•¥

#### å…³é”®æŒ‡æ ‡ç›‘æ§

1. **æ–‡ä»¶å¥æŸ„ä½¿ç”¨ç‡**: ç›‘æ§ `open_files` æŒ‡æ ‡
2. **å†…å­˜ä½¿ç”¨æƒ…å†µ**: ç›‘æ§ `memory_usage_mb` æŒ‡æ ‡
3. **è¿›ç¨‹å¥åº·çŠ¶æ€**: ç›‘æ§ `active_processes` æŒ‡æ ‡
4. **ç³»ç»Ÿå“åº”æ—¶é—´**: ç›‘æ§è¯Šæ–­æ‰§è¡Œæ—¶é—´

#### å‘Šè­¦ç­–ç•¥

1. **åˆ†çº§å‘Šè­¦**: è®¾ç½®è­¦å‘Šå’Œä¸¥é‡ä¸¤çº§é˜ˆå€¼
2. **å‘Šè­¦æŠ‘åˆ¶**: é…ç½®é€‚å½“çš„å†·å´æ—¶é—´
3. **å‘Šè­¦èšåˆ**: é¿å…å‘Šè­¦é£æš´
4. **å‘Šè­¦è·¯ç”±**: ä¸åŒçº§åˆ«å‘Šè­¦å‘é€ç»™ä¸åŒäººå‘˜

## 10. ç”Ÿäº§éƒ¨ç½²

### 10.1 éƒ¨ç½²å‰æ£€æŸ¥

```bash
# 1. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
uv run python comprehensive_test.py

# 2. æ£€æŸ¥ç³»ç»Ÿèµ„æº
uv run python -c "
import psutil
print(f'CPUæ ¸å¿ƒæ•°: {psutil.cpu_count()}')
print(f'å†…å­˜æ€»é‡: {psutil.virtual_memory().total // (1024**3)}GB')
print(f'ç£ç›˜ç©ºé—´: {psutil.disk_usage(\"/\").free // (1024**3)}GB')
"

# 3. éªŒè¯ç½‘ç»œè¿æ¥
uv run python main.py google.com
```

### 10.2 éƒ¨ç½²é…ç½®

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
cat > .env << EOF
LOG_LEVEL=INFO
MAX_CONCURRENT=5
TIMEOUT_SECONDS=30
MONITORING_ENABLED=true
AUTO_RECOVERY_ENABLED=true
ALERT_COOLDOWN_SECONDS=300
EOF
```

#### ç³»ç»ŸæœåŠ¡é…ç½®

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/network-diagnosis.service << EOF
[Unit]
Description=Network Diagnosis Tool
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/probing
ExecStart=/path/to/uv run python scheduler_main.py -c network-diagnosis/input/targets.yaml
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl enable network-diagnosis
sudo systemctl start network-diagnosis
```

### 10.3 ç›‘æ§å’Œç»´æŠ¤

#### æ—¥å¸¸ç›‘æ§

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status network-diagnosis

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u network-diagnosis -f

# æ£€æŸ¥ç³»ç»Ÿå¥åº·
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.resource_monitor import ResourceMonitor
monitor = ResourceMonitor()
status = monitor.get_comprehensive_status()
print(f'ç³»ç»ŸçŠ¶æ€: {status[\"overall_status\"]}')
"
```

#### å®šæœŸç»´æŠ¤

```bash
# æ¯å‘¨æ‰§è¡Œçš„ç»´æŠ¤ä»»åŠ¡
#!/bin/bash

# 1. æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
find network-diagnosis/log -name "*.log" -mtime +7 -delete

# 2. æ¸…ç†æ—§ç›‘æ§æ•°æ®
find network-diagnosis/monitoring_data -name "*.jsonl" -mtime +30 -delete

# 3. è¿è¡Œç³»ç»Ÿæµ‹è¯•
uv run python comprehensive_test.py

# 4. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
uv run python -c "
import sys
sys.path.insert(0, 'network-diagnosis/src')
from network_diagnosis.resource_monitor import ResourceMonitor
monitor = ResourceMonitor()
status = monitor.get_comprehensive_status()
if status['overall_status'] != 'healthy':
    print('âš ï¸ ç³»ç»ŸçŠ¶æ€å¼‚å¸¸ï¼Œéœ€è¦æ£€æŸ¥')
    exit(1)
else:
    print('âœ… ç³»ç»ŸçŠ¶æ€æ­£å¸¸')
"
```

### 10.4 å¤‡ä»½å’Œæ¢å¤

#### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf backup-$(date +%Y%m%d).tar.gz \
    network-diagnosis/input/ \
    network-diagnosis/monitoring_data/ \
    .env

# å¤‡ä»½åˆ°è¿œç¨‹ä½ç½®
rsync -av backup-*.tar.gz user@backup-server:/backup/network-diagnosis/
```

#### ç¾éš¾æ¢å¤

```bash
# æ¢å¤é…ç½®
tar -xzf backup-20240923.tar.gz

# é‡å¯æœåŠ¡
sudo systemctl restart network-diagnosis

# éªŒè¯æ¢å¤
uv run python comprehensive_test.py
```

---

**ğŸ‰ æœ¬ç”¨æˆ·æ‰‹å†Œæä¾›äº†ç½‘ç»œè¯Šæ–­å·¥å…·çš„å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼ŒåŒ…æ‹¬åŸºç¡€åŠŸèƒ½ã€ä¼ä¸šçº§ç‰¹æ€§ã€ç›‘æ§å‘Šè­¦ã€æ•…éšœæ’æŸ¥å’Œç”Ÿäº§éƒ¨ç½²çš„æœ€ä½³å®è·µã€‚**
